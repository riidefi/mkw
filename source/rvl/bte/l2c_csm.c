#include "l2c_csm.h"

#include "gki_buffer.h"
#include "bte_logmsg.h"
#include "bte_task1.h"
#include "btm_sec.h"
#include "l2c_link.h"
#include "l2c_utils.h"

// Symbol: l2c_csm_execute
// PAL: 0x8014ac2c..0x8014ac78
MARK_BINARY_BLOB(l2c_csm_execute, 0x8014ac2c, 0x8014ac78);
asm UNKNOWN_FUNCTION(l2c_csm_execute) {
  // clang-format off
  nofralloc;
  lwz r0, 4(r3);
  cmplwi r0, 8;
  bgtlr;
  lis r6, 0x8028;
  slwi r0, r0, 2;
  addi r6, r6, 0x5c30;
  lwzx r6, r6, r0;
  mtctr r6;
  bctr;
  b l2c_csm_closed;
  b l2c_csm_orig_w4_sec_comp;
  b l2c_csm_term_w4_sec_comp;
  b l2c_csm_w4_l2cap_connect_rsp;
  b l2c_csm_w4_l2ca_connect_rsp;
  b l2c_csm_config;
  b l2c_csm_open;
  b l2c_csm_w4_l2cap_disconnect_rsp;
  b l2c_csm_w4_l2ca_disconnect_rsp;
  blr;
  // clang-format on
}

// Symbol: l2c_csm_closed
// PAL: 0x8014ac78..0x8014af0c
MARK_BINARY_BLOB(l2c_csm_closed, 0x8014ac78, 0x8014af0c);
asm UNKNOWN_FUNCTION(l2c_csm_closed) {
  // clang-format off
  nofralloc;
  stwu r1, -0x30(r1);
  mflr r0;
  stw r0, 0x34(r1);
  addi r11, r1, 0x30;
  bl _savegpr_25;
  lis r6, 0x8034;
  lwz r7, 0x30(r3);
  lbz r0, -0x6cc0(r6);
  lis r31, 0x8028;
  lwz r27, 0x18(r7);
  mr r28, r3;
  cmplwi r0, 4;
  lwz r30, 8(r7);
  lhz r29, 0x14(r3);
  mr r25, r4;
  mr r26, r5;
  addi r31, r31, 0x5c30;
  blt lbl_8014acd4;
  lis r3, 8;
  mr r5, r25;
  addi r3, r3, 3;
  addi r4, r31, 0x24;
  bl LogMsg_1;
lbl_8014acd4:
  cmplwi r25, 0x1e;
  bgt lbl_8014aef4;
  lis r3, 0x8028;
  slwi r0, r25, 2;
  addi r3, r3, 0x5cf0;
  lwzx r3, r3, r0;
  mtctr r3;
  bctr;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014ad18;
  lis r3, 8;
  lhz r5, 0x14(r28);
  addi r3, r3, 2;
  addi r4, r31, 0x40;
  bl LogMsg_1;
lbl_8014ad18:
  mr r3, r28;
  bl l2cu_release_ccb;
  mr r12, r27;
  mr r3, r29;
  li r4, 0;
  mtctr r12;
  bctrl;
  b lbl_8014aef4;
  li r0, 1;
  lwz r5, 0x10(r28);
  stw r0, 4(r28);
  lis r7, 0x8015;
  lwz r4, 0x30(r28);
  addi r3, r5, 0x2a;
  lhz r5, 0x28(r5);
  addi r7, r7, -15212;
  lhz r4, 2(r4);
  li r6, 1;
  bl btm_sec_l2cap_access_req;
  b lbl_8014aef4;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014ad90;
  lis r3, 8;
  lhz r5, 0x14(r28);
  lbz r6, 6(r26);
  addi r3, r3, 2;
  addi r4, r31, 0x84;
  bl LogMsg_2;
lbl_8014ad90:
  mr r3, r28;
  bl l2cu_release_ccb;
  mr r12, r30;
  mr r3, r29;
  lbz r4, 6(r26);
  mtctr r12;
  bctrl;
  b lbl_8014aef4;
  lwz r3, 0x10(r28);
  lis r7, 0x8015;
  lwz r4, 0x30(r28);
  addi r7, r7, -15212;
  lhz r5, 0x28(r3);
  addi r3, r3, 0x2a;
  lhz r4, 2(r4);
  li r6, 1;
  bl btm_sec_l2cap_access_req;
  clrlwi r0, r3, 0x18;
  cmplwi r0, 1;
  bne lbl_8014aef4;
  li r0, 1;
  stw r0, 4(r28);
  b lbl_8014aef4;
  mr r3, r28;
  bl l2cu_send_peer_connect_req;
  li r0, 3;
  addi r3, r28, 0x18;
  stw r0, 4(r28);
  li r4, 3;
  li r5, 0x3c;
  bl btu_start_timer;
  b lbl_8014aef4;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014ae3c;
  lis r3, 8;
  lis r6, 1;
  lhz r5, 0x14(r28);
  addi r3, r3, 2;
  addi r4, r31, 0x84;
  addi r6, r6, -4370;
  bl LogMsg_2;
lbl_8014ae3c:
  mr r3, r28;
  bl l2cu_release_ccb;
  mr r12, r30;
  mr r3, r29;
  li r4, 3;
  mtctr r12;
  bctrl;
  b lbl_8014aef4;
  li r0, 2;
  lwz r5, 0x10(r28);
  stw r0, 4(r28);
  lis r7, 0x8015;
  lwz r4, 0x30(r28);
  addi r3, r5, 0x2a;
  lhz r5, 0x28(r5);
  addi r7, r7, -15212;
  lhz r4, 2(r4);
  li r6, 0;
  bl btm_sec_l2cap_access_req;
  b lbl_8014aef4;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014aeb8;
  lis r3, 8;
  lis r6, 1;
  lhz r5, 0x14(r28);
  addi r3, r3, 2;
  addi r4, r31, 0x84;
  addi r6, r6, -4370;
  bl LogMsg_2;
lbl_8014aeb8:
  mr r3, r28;
  bl l2cu_release_ccb;
  lis r3, 1;
  mr r12, r30;
  addi r0, r3, -4370;
  mr r3, r29;
  clrlwi r4, r0, 0x10;
  mtctr r12;
  bctrl;
  b lbl_8014aef4;
  mr r3, r26;
  bl GKI_freebuf;
  b lbl_8014aef4;
  mr r3, r28;
  bl l2cu_release_ccb;
lbl_8014aef4:
  addi r11, r1, 0x30;
  bl _restgpr_25;
  lwz r0, 0x34(r1);
  mtlr r0;
  addi r1, r1, 0x30;
  blr;
  // clang-format on
}

// Symbol: l2c_csm_orig_w4_sec_comp
// PAL: 0x8014af0c..0x8014b07c
MARK_BINARY_BLOB(l2c_csm_orig_w4_sec_comp, 0x8014af0c, 0x8014b07c);
asm UNKNOWN_FUNCTION(l2c_csm_orig_w4_sec_comp) {
  // clang-format off
  nofralloc;
  stwu r1, -0x30(r1);
  mflr r0;
  stw r0, 0x34(r1);
  addi r11, r1, 0x30;
  bl _savegpr_25;
  lis r6, 0x8034;
  lwz r7, 0x30(r3);
  lbz r0, -0x6cc0(r6);
  lis r30, 0x8028;
  lwz r29, 0x18(r7);
  mr r31, r3;
  cmplwi r0, 4;
  lwz r28, 8(r7);
  lhz r27, 0x14(r3);
  mr r25, r4;
  mr r26, r5;
  addi r30, r30, 0x5c30;
  blt lbl_8014af68;
  lis r3, 8;
  mr r5, r25;
  addi r3, r3, 3;
  addi r4, r30, 0x13c;
  bl LogMsg_1;
lbl_8014af68:
  addi r0, r25, -3;
  cmplwi r0, 0x1a;
  bgt lbl_8014b064;
  lis r3, 0x8028;
  slwi r0, r0, 2;
  addi r3, r3, 0x5d94;
  lwzx r3, r3, r0;
  mtctr r3;
  bctr;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014afb0;
  lis r3, 8;
  lhz r5, 0x14(r31);
  addi r3, r3, 2;
  addi r4, r30, 0x40;
  bl LogMsg_1;
lbl_8014afb0:
  mr r3, r31;
  bl l2cu_release_ccb;
  mr r12, r29;
  mr r3, r27;
  li r4, 0;
  mtctr r12;
  bctrl;
  b lbl_8014b064;
  li r0, 3;
  addi r3, r31, 0x18;
  stw r0, 4(r31);
  li r4, 3;
  li r5, 0x3c;
  bl btu_start_timer;
  mr r3, r31;
  bl l2cu_send_peer_connect_req;
  li r0, 0;
  stb r0, 0x37(r31);
  b lbl_8014b064;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b024;
  lis r3, 8;
  lhz r5, 0x14(r31);
  addi r3, r3, 2;
  addi r4, r30, 0x84;
  li r6, 5;
  bl LogMsg_2;
lbl_8014b024:
  mr r3, r31;
  bl l2cu_release_ccb;
  mr r12, r28;
  mr r3, r27;
  li r4, 5;
  mtctr r12;
  bctrl;
  b lbl_8014b064;
  mr r3, r26;
  bl GKI_freebuf;
  b lbl_8014b064;
  lwz r3, 0x10(r31);
  addi r3, r3, 0x2a;
  bl btm_sec_abort_access_req;
  mr r3, r31;
  bl l2cu_release_ccb;
lbl_8014b064:
  addi r11, r1, 0x30;
  bl _restgpr_25;
  lwz r0, 0x34(r1);
  mtlr r0;
  addi r1, r1, 0x30;
  blr;
  // clang-format on
}

// Symbol: l2c_csm_term_w4_sec_comp
// PAL: 0x8014b07c..0x8014b1e4
MARK_BINARY_BLOB(l2c_csm_term_w4_sec_comp, 0x8014b07c, 0x8014b1e4);
asm UNKNOWN_FUNCTION(l2c_csm_term_w4_sec_comp) {
  // clang-format off
  nofralloc;
  stwu r1, -0x20(r1);
  mflr r0;
  lis r6, 0x8034;
  stw r0, 0x24(r1);
  stw r31, 0x1c(r1);
  mr r31, r5;
  stw r30, 0x18(r1);
  mr r30, r4;
  stw r29, 0x14(r1);
  mr r29, r3;
  lbz r0, -0x6cc0(r6);
  cmplwi r0, 4;
  blt lbl_8014b0c8;
  lis r3, 8;
  lis r4, 0x8028;
  mr r5, r30;
  addi r3, r3, 3;
  addi r4, r4, 0x5e00;
  bl LogMsg_1;
lbl_8014b0c8:
  addi r0, r30, -3;
  cmplwi r0, 0x1a;
  bgt lbl_8014b1c8;
  lis r3, 0x8028;
  slwi r0, r0, 2;
  addi r3, r3, 0x5e58;
  lwzx r3, r3, r0;
  mtctr r3;
  bctr;
  lwz r3, 0x10(r29);
  addi r3, r3, 0x2a;
  bl btm_sec_abort_access_req;
  mr r3, r29;
  bl l2cu_release_ccb;
  b lbl_8014b1c8;
  li r0, 4;
  addi r3, r29, 0x18;
  stw r0, 4(r29);
  li r4, 3;
  li r5, 0x3c;
  bl btu_start_timer;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b144;
  lis r3, 8;
  lis r4, 0x8028;
  lhz r5, 0x14(r29);
  addi r3, r3, 2;
  addi r4, r4, 0x5e28;
  bl LogMsg_1;
lbl_8014b144:
  lwz r5, 0x30(r29);
  lwz r3, 0x10(r29);
  lwz r12, 4(r5);
  addi r3, r3, 0x2a;
  lhz r4, 0x14(r29);
  lhz r5, 2(r5);
  lbz r6, 0x36(r29);
  mtctr r12;
  bctrl;
  b lbl_8014b1c8;
  mr r3, r29;
  li r4, 3;
  li r5, 0;
  bl l2cu_send_peer_connect_rsp;
  mr r3, r29;
  bl l2cu_release_ccb;
  b lbl_8014b1c8;
  mr r3, r31;
  bl GKI_freebuf;
  b lbl_8014b1c8;
  mr r3, r29;
  bl l2cu_release_ccb;
  b lbl_8014b1c8;
  lwz r3, 0x10(r29);
  lbz r4, 0x36(r29);
  lhz r5, 0x14(r29);
  lhz r6, 0x16(r29);
  bl l2cu_send_peer_disc_rsp;
  lwz r3, 0x10(r29);
  addi r3, r3, 0x2a;
  bl btm_sec_abort_access_req;
  mr r3, r29;
  bl l2cu_release_ccb;
lbl_8014b1c8:
  lwz r0, 0x24(r1);
  lwz r31, 0x1c(r1);
  lwz r30, 0x18(r1);
  lwz r29, 0x14(r1);
  mtlr r0;
  addi r1, r1, 0x20;
  blr;
  // clang-format on
}

// Symbol: l2c_csm_w4_l2cap_connect_rsp
// PAL: 0x8014b1e4..0x8014b428
MARK_BINARY_BLOB(l2c_csm_w4_l2cap_connect_rsp, 0x8014b1e4, 0x8014b428);
asm UNKNOWN_FUNCTION(l2c_csm_w4_l2cap_connect_rsp) {
  // clang-format off
  nofralloc;
  stwu r1, -0x30(r1);
  mflr r0;
  stw r0, 0x34(r1);
  addi r11, r1, 0x30;
  bl _savegpr_25;
  lis r6, 0x8034;
  lwz r7, 0x30(r3);
  lbz r0, -0x6cc0(r6);
  lis r31, 0x8028;
  lwz r28, 0x18(r7);
  mr r29, r3;
  cmplwi r0, 4;
  lwz r27, 8(r7);
  lhz r30, 0x14(r3);
  mr r25, r4;
  mr r26, r5;
  addi r31, r31, 0x5c30;
  blt lbl_8014b240;
  lis r3, 8;
  mr r5, r25;
  addi r3, r3, 3;
  addi r4, r31, 0x294;
  bl LogMsg_1;
lbl_8014b240:
  addi r0, r25, -3;
  cmplwi r0, 0x1b;
  bgt lbl_8014b410;
  lis r3, 0x8028;
  slwi r0, r0, 2;
  addi r3, r3, 0x5fc0;
  lwzx r3, r3, r0;
  mtctr r3;
  bctr;
  li r0, 0;
  lis r3, 0x8034;
  stw r0, 4(r29);
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b290;
  lis r3, 8;
  lhz r5, 0x14(r29);
  addi r3, r3, 2;
  addi r4, r31, 0x40;
  bl LogMsg_1;
lbl_8014b290:
  mr r3, r29;
  bl l2cu_release_ccb;
  mr r12, r28;
  mr r3, r30;
  li r4, 0;
  mtctr r12;
  bctrl;
  b lbl_8014b410;
  lhz r5, 0xe(r26);
  li r0, 5;
  addi r3, r29, 0x18;
  li r4, 3;
  sth r5, 0x16(r29);
  li r5, 0x1e;
  stw r0, 4(r29);
  bl btu_start_timer;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b2f4;
  lis r3, 8;
  lhz r5, 0x14(r29);
  addi r3, r3, 2;
  addi r4, r31, 0x2bc;
  bl LogMsg_1;
lbl_8014b2f4:
  lwz r5, 0x30(r29);
  li r4, 0;
  lhz r3, 0x14(r29);
  lwz r12, 8(r5);
  mtctr r12;
  bctrl;
  b lbl_8014b410;
  addi r3, r29, 0x18;
  li r4, 3;
  li r5, 0x78;
  bl btu_start_timer;
  lwz r3, 0x30(r29);
  lwz r0, 0xc(r3);
  cmpwi r0, 0;
  beq lbl_8014b410;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b350;
  lis r3, 8;
  addi r4, r31, 0x2f4;
  addi r3, r3, 2;
  bl LogMsg_0;
lbl_8014b350:
  lwz r4, 0x30(r29);
  li r3, 0;
  lwz r12, 0xc(r4);
  mtctr r12;
  bctrl;
  b lbl_8014b410;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b390;
  lis r3, 8;
  lhz r5, 0x14(r29);
  lhz r6, 0xa(r26);
  addi r3, r3, 2;
  addi r4, r31, 0x318;
  bl LogMsg_2;
lbl_8014b390:
  mr r3, r29;
  bl l2cu_release_ccb;
  mr r12, r27;
  mr r3, r30;
  lhz r4, 0xa(r26);
  mtctr r12;
  bctrl;
  b lbl_8014b410;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b3d4;
  lis r3, 8;
  lhz r5, 0x14(r29);
  addi r3, r3, 2;
  addi r4, r31, 0x358;
  bl LogMsg_1;
lbl_8014b3d4:
  mr r3, r29;
  bl l2cu_release_ccb;
  lis r3, 1;
  mr r12, r27;
  addi r0, r3, -4370;
  mr r3, r30;
  clrlwi r4, r0, 0x10;
  mtctr r12;
  bctrl;
  b lbl_8014b410;
  mr r3, r29;
  bl l2cu_release_ccb;
  b lbl_8014b410;
  mr r3, r26;
  bl GKI_freebuf;
lbl_8014b410:
  addi r11, r1, 0x30;
  bl _restgpr_25;
  lwz r0, 0x34(r1);
  mtlr r0;
  addi r1, r1, 0x30;
  blr;
  // clang-format on
}

// Symbol: l2c_csm_w4_l2ca_connect_rsp
// PAL: 0x8014b428..0x8014b600
MARK_BINARY_BLOB(l2c_csm_w4_l2ca_connect_rsp, 0x8014b428, 0x8014b600);
asm UNKNOWN_FUNCTION(l2c_csm_w4_l2ca_connect_rsp) {
  // clang-format off
  nofralloc;
  stwu r1, -0x20(r1);
  mflr r0;
  stw r0, 0x24(r1);
  addi r11, r1, 0x20;
  bl _savegpr_27;
  lis r6, 0x8034;
  lwz r7, 0x30(r3);
  lbz r0, -0x6cc0(r6);
  mr r31, r3;
  lwz r30, 0x18(r7);
  mr r27, r4;
  cmplwi r0, 4;
  lhz r29, 0x14(r3);
  mr r28, r5;
  blt lbl_8014b47c;
  lis r3, 8;
  lis r4, 0x8028;
  mr r5, r27;
  addi r3, r3, 3;
  addi r4, r4, 0x6030;
  bl LogMsg_1;
lbl_8014b47c:
  addi r0, r27, -3;
  cmplwi r0, 0x1b;
  bgt lbl_8014b5e8;
  lis r3, 0x8028;
  slwi r0, r0, 2;
  addi r3, r3, 0x6054;
  lwzx r3, r3, r0;
  mtctr r3;
  bctr;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b4c8;
  lis r3, 8;
  lis r4, 0x8028;
  lhz r5, 0x14(r31);
  addi r3, r3, 2;
  addi r4, r4, 0x5c70;
  bl LogMsg_1;
lbl_8014b4c8:
  mr r3, r31;
  bl l2cu_release_ccb;
  mr r12, r30;
  mr r3, r29;
  li r4, 0;
  mtctr r12;
  bctrl;
  b lbl_8014b5e8;
  cmpwi r28, 0;
  beq lbl_8014b4fc;
  lhz r4, 0xa(r28);
  cmpwi r4, 0;
  bne lbl_8014b528;
lbl_8014b4fc:
  mr r3, r31;
  li r4, 0;
  li r5, 0;
  bl l2cu_send_peer_connect_rsp;
  li r0, 5;
  addi r3, r31, 0x18;
  stw r0, 4(r31);
  li r4, 3;
  li r5, 0x1e;
  bl btu_start_timer;
  b lbl_8014b5e8;
lbl_8014b528:
  lhz r5, 0xc(r28);
  mr r3, r31;
  bl l2cu_send_peer_connect_rsp;
  addi r3, r31, 0x18;
  li r4, 3;
  li r5, 0x78;
  bl btu_start_timer;
  b lbl_8014b5e8;
  lhz r4, 0xa(r28);
  mr r3, r31;
  lhz r5, 0xc(r28);
  bl l2cu_send_peer_connect_rsp;
  mr r3, r31;
  bl l2cu_release_ccb;
  b lbl_8014b5e8;
  mr r3, r31;
  li r4, 2;
  li r5, 0;
  bl l2cu_send_peer_connect_rsp;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b59c;
  lis r3, 8;
  lis r4, 0x8028;
  lhz r5, 0x14(r31);
  addi r3, r3, 2;
  addi r4, r4, 0x5c70;
  bl LogMsg_1;
lbl_8014b59c:
  mr r3, r31;
  bl l2cu_release_ccb;
  mr r12, r30;
  mr r3, r29;
  li r4, 0;
  mtctr r12;
  bctrl;
  b lbl_8014b5e8;
  mr r3, r28;
  bl GKI_freebuf;
  b lbl_8014b5e8;
  mr r3, r31;
  bl l2cu_send_peer_disc_req;
  li r0, 7;
  addi r3, r31, 0x18;
  stw r0, 4(r31);
  li r4, 3;
  li r5, 0x1e;
  bl btu_start_timer;
lbl_8014b5e8:
  addi r11, r1, 0x20;
  bl _restgpr_27;
  lwz r0, 0x24(r1);
  mtlr r0;
  addi r1, r1, 0x20;
  blr;
  // clang-format on
}

// Symbol: l2c_csm_config
// PAL: 0x8014b600..0x8014b9c8
MARK_BINARY_BLOB(l2c_csm_config, 0x8014b600, 0x8014b9c8);
asm UNKNOWN_FUNCTION(l2c_csm_config) {
  // clang-format off
  nofralloc;
  stwu r1, -0x20(r1);
  mflr r0;
  stw r0, 0x24(r1);
  addi r11, r1, 0x20;
  bl _savegpr_26;
  lis r6, 0x8034;
  lwz r7, 0x30(r3);
  lbz r0, -0x6cc0(r6);
  lis r31, 0x8028;
  lwz r28, 0x18(r7);
  mr r30, r5;
  cmplwi r0, 4;
  lhz r27, 0x14(r3);
  mr r29, r3;
  mr r26, r4;
  addi r31, r31, 0x5c30;
  blt lbl_8014b658;
  lis r3, 8;
  mr r5, r26;
  addi r3, r3, 3;
  addi r4, r31, 0x494;
  bl LogMsg_1;
lbl_8014b658:
  addi r0, r26, -3;
  cmplwi r0, 0x1b;
  bgt lbl_8014b9b0;
  lis r3, 0x8028;
  slwi r0, r0, 2;
  addi r3, r3, 0x61e8;
  lwzx r3, r3, r0;
  mtctr r3;
  bctr;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b6a0;
  lis r3, 8;
  lhz r5, 0x14(r29);
  addi r3, r3, 2;
  addi r4, r31, 0x40;
  bl LogMsg_1;
lbl_8014b6a0:
  mr r3, r29;
  bl l2cu_release_ccb;
  mr r12, r28;
  mr r3, r27;
  li r4, 0;
  mtctr r12;
  bctrl;
  b lbl_8014b9b0;
  mr r3, r29;
  mr r4, r30;
  bl l2cu_process_peer_cfg_req;
  clrlwi. r0, r3, 0x18;
  beq lbl_8014b714;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b6f8;
  lis r3, 8;
  lhz r5, 0x14(r29);
  addi r3, r3, 2;
  addi r4, r31, 0x4b0;
  bl LogMsg_1;
lbl_8014b6f8:
  lwz r5, 0x30(r29);
  mr r4, r30;
  lhz r3, 0x14(r29);
  lwz r12, 0x10(r5);
  mtctr r12;
  bctrl;
  b lbl_8014b9b0;
lbl_8014b714:
  mr r3, r29;
  mr r4, r30;
  bl l2cu_send_peer_config_rsp;
  b lbl_8014b9b0;
  mr r3, r29;
  mr r4, r30;
  bl l2cu_process_peer_cfg_rsp;
  lbz r0, 0x34(r29);
  ori r3, r0, 2;
  clrlwi. r0, r3, 0x1f;
  stb r3, 0x34(r29);
  beq lbl_8014b760;
  li r0, 6;
  addi r3, r29, 0x18;
  stw r0, 4(r29);
  bl btu_stop_timer;
  mr r3, r29;
  li r4, 0;
  bl forward_peer_data;
lbl_8014b760:
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b784;
  lis r3, 8;
  lhz r5, 0x14(r29);
  addi r3, r3, 2;
  addi r4, r31, 0x4e0;
  bl LogMsg_1;
lbl_8014b784:
  lwz r5, 0x30(r29);
  mr r4, r30;
  lhz r3, 0x14(r29);
  lwz r12, 0x14(r5);
  mtctr r12;
  bctrl;
  b lbl_8014b9b0;
  addi r3, r29, 0x18;
  bl btu_stop_timer;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b7d0;
  lis r3, 8;
  lhz r5, 0x14(r29);
  lhz r6, 0(r30);
  addi r3, r3, 2;
  addi r4, r31, 0x510;
  bl LogMsg_2;
lbl_8014b7d0:
  lwz r5, 0x30(r29);
  mr r4, r30;
  lhz r3, 0x14(r29);
  lwz r12, 0x14(r5);
  mtctr r12;
  bctrl;
  b lbl_8014b9b0;
  addi r3, r29, 0x18;
  li r4, 3;
  li r5, 0x1e;
  bl btu_start_timer;
  li r0, 8;
  lis r3, 0x8034;
  stw r0, 4(r29);
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b828;
  lis r3, 8;
  lhz r5, 0x14(r29);
  addi r3, r3, 2;
  addi r4, r31, 0x54c;
  bl LogMsg_1;
lbl_8014b828:
  lwz r5, 0x30(r29);
  li r4, 1;
  lhz r3, 0x14(r29);
  lwz r12, 0x18(r5);
  mtctr r12;
  bctrl;
  b lbl_8014b9b0;
  mr r3, r29;
  mr r4, r30;
  bl l2cu_process_our_cfg_req;
  mr r3, r29;
  mr r4, r30;
  bl l2cu_send_peer_config_req;
  addi r3, r29, 0x18;
  li r4, 3;
  li r5, 0x1e;
  bl btu_start_timer;
  b lbl_8014b9b0;
  mr r3, r29;
  mr r4, r30;
  bl l2cu_process_our_cfg_rsp;
  lbz r0, 0x34(r29);
  ori r3, r0, 1;
  rlwinm. r0, r3, 0, 0x1e, 0x1e;
  stb r3, 0x34(r29);
  beq lbl_8014b8ac;
  li r0, 6;
  addi r3, r29, 0x18;
  stw r0, 4(r29);
  bl btu_stop_timer;
  mr r3, r29;
  li r4, 0;
  bl forward_peer_data;
lbl_8014b8ac:
  mr r3, r29;
  mr r4, r30;
  bl l2cu_send_peer_config_rsp;
  b lbl_8014b9b0;
  mr r3, r29;
  mr r4, r30;
  bl l2cu_send_peer_config_rsp;
  addi r3, r29, 0x18;
  li r4, 3;
  li r5, 0x1e;
  bl btu_start_timer;
  b lbl_8014b9b0;
  mr r3, r29;
  bl l2cu_send_peer_disc_req;
  li r0, 7;
  addi r3, r29, 0x18;
  stw r0, 4(r29);
  li r4, 3;
  li r5, 0x1e;
  bl btu_start_timer;
  b lbl_8014b9b0;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b924;
  lis r3, 8;
  lhz r5, 0x14(r29);
  addi r3, r3, 2;
  addi r4, r31, 0x58c;
  bl LogMsg_1;
lbl_8014b924:
  lwz r5, 0x30(r29);
  mr r4, r30;
  lhz r3, 0x14(r29);
  lwz r12, 0x24(r5);
  mtctr r12;
  bctrl;
  b lbl_8014b9b0;
  lbz r0, 0x34(r29);
  rlwinm. r0, r0, 0, 0x1e, 0x1e;
  beq lbl_8014b95c;
  mr r4, r30;
  addi r3, r29, 0x70;
  bl GKI_enqueue;
  b lbl_8014b9b0;
lbl_8014b95c:
  mr r3, r30;
  bl GKI_freebuf;
  b lbl_8014b9b0;
  mr r3, r29;
  bl l2cu_send_peer_disc_req;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014b994;
  lis r3, 8;
  lhz r5, 0x14(r29);
  addi r3, r3, 2;
  addi r4, r31, 0x40;
  bl LogMsg_1;
lbl_8014b994:
  mr r3, r29;
  bl l2cu_release_ccb;
  mr r12, r28;
  mr r3, r27;
  li r4, 0;
  mtctr r12;
  bctrl;
lbl_8014b9b0:
  addi r11, r1, 0x20;
  bl _restgpr_26;
  lwz r0, 0x24(r1);
  mtlr r0;
  addi r1, r1, 0x20;
  blr;
  // clang-format on
}

// Symbol: l2c_csm_open
// PAL: 0x8014b9c8..0x8014bc24
MARK_BINARY_BLOB(l2c_csm_open, 0x8014b9c8, 0x8014bc24);
asm UNKNOWN_FUNCTION(l2c_csm_open) {
  // clang-format off
  nofralloc;
  stwu r1, -0x20(r1);
  mflr r0;
  stw r0, 0x24(r1);
  addi r11, r1, 0x20;
  bl _savegpr_26;
  lis r6, 0x8034;
  lwz r7, 0x30(r3);
  lbz r0, -0x6cc0(r6);
  lis r30, 0x8028;
  lwz r29, 0x18(r7);
  mr r31, r3;
  cmplwi r0, 4;
  lhz r28, 0x14(r3);
  mr r26, r4;
  mr r27, r5;
  addi r30, r30, 0x5c30;
  blt lbl_8014ba20;
  lis r3, 8;
  mr r5, r26;
  addi r3, r3, 3;
  addi r4, r30, 0x628;
  bl LogMsg_1;
lbl_8014ba20:
  addi r0, r26, -3;
  cmplwi r0, 0x1a;
  bgt lbl_8014bc0c;
  lis r3, 0x8028;
  slwi r0, r0, 2;
  addi r3, r3, 0x6274;
  lwzx r3, r3, r0;
  mtctr r3;
  bctr;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014ba68;
  lis r3, 8;
  lhz r5, 0x14(r31);
  addi r3, r3, 2;
  addi r4, r30, 0x40;
  bl LogMsg_1;
lbl_8014ba68:
  mr r3, r31;
  bl l2cu_release_ccb;
  mr r12, r29;
  mr r3, r28;
  li r4, 0;
  mtctr r12;
  bctrl;
  b lbl_8014bc0c;
  lwz r3, 0x30(r31);
  lwz r12, 0x20(r3);
  cmpwi r12, 0;
  beq lbl_8014bc0c;
  lwz r3, 0x10(r31);
  addi r3, r3, 0x2a;
  mtctr r12;
  bctrl;
  b lbl_8014bc0c;
  lwz r28, 4(r31);
  li r3, 5;
  lbz r29, 0x34(r31);
  li r0, 0;
  stw r3, 4(r31);
  addi r3, r31, 0x18;
  li r4, 3;
  li r5, 0x1e;
  stb r0, 0x34(r31);
  bl btu_start_timer;
  mr r3, r31;
  mr r4, r27;
  bl l2cu_process_peer_cfg_req;
  clrlwi. r0, r3, 0x18;
  beq lbl_8014bb04;
  lwz r5, 0x30(r31);
  mr r4, r27;
  lhz r3, 0x14(r31);
  lwz r12, 0x10(r5);
  mtctr r12;
  bctrl;
  b lbl_8014bc0c;
lbl_8014bb04:
  addi r3, r31, 0x18;
  bl btu_stop_timer;
  stw r28, 4(r31);
  mr r3, r31;
  mr r4, r27;
  stb r29, 0x34(r31);
  bl l2cu_send_peer_config_rsp;
  b lbl_8014bc0c;
  li r0, 8;
  addi r3, r31, 0x18;
  stw r0, 4(r31);
  li r4, 3;
  li r5, 0x1e;
  bl btu_start_timer;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014bb60;
  lis r3, 8;
  lhz r5, 0x14(r31);
  addi r3, r3, 2;
  addi r4, r30, 0x54c;
  bl LogMsg_1;
lbl_8014bb60:
  lwz r5, 0x30(r31);
  li r4, 1;
  lhz r3, 0x14(r31);
  lwz r12, 0x18(r5);
  mtctr r12;
  bctrl;
  b lbl_8014bc0c;
  lwz r5, 0x30(r31);
  mr r4, r27;
  lhz r3, 0x14(r31);
  lwz r12, 0x24(r5);
  mtctr r12;
  bctrl;
  b lbl_8014bc0c;
  mr r3, r31;
  bl l2cu_send_peer_disc_req;
  li r0, 7;
  addi r3, r31, 0x18;
  stw r0, 4(r31);
  li r4, 3;
  li r5, 0x1e;
  bl btu_start_timer;
  b lbl_8014bc0c;
  lhz r0, 0x14(r31);
  mr r3, r31;
  mr r4, r27;
  sth r0, 0(r27);
  bl forward_peer_data;
  b lbl_8014bc0c;
  mr r3, r31;
  mr r4, r27;
  bl l2cu_process_our_cfg_req;
  mr r3, r31;
  mr r4, r27;
  bl l2cu_send_peer_config_req;
  li r3, 5;
  li r0, 0;
  stw r3, 4(r31);
  addi r3, r31, 0x18;
  li r4, 3;
  li r5, 0x1e;
  stb r0, 0x34(r31);
  bl btu_start_timer;
lbl_8014bc0c:
  addi r11, r1, 0x20;
  bl _restgpr_26;
  lwz r0, 0x24(r1);
  mtlr r0;
  addi r1, r1, 0x20;
  blr;
  // clang-format on
}

// Symbol: l2c_csm_w4_l2cap_disconnect_rsp
// PAL: 0x8014bc24..0x8014be08
MARK_BINARY_BLOB(l2c_csm_w4_l2cap_disconnect_rsp, 0x8014bc24, 0x8014be08);
asm UNKNOWN_FUNCTION(l2c_csm_w4_l2cap_disconnect_rsp) {
  // clang-format off
  nofralloc;
  stwu r1, -0x30(r1);
  mflr r0;
  stw r0, 0x34(r1);
  addi r11, r1, 0x30;
  bl _savegpr_25;
  lis r6, 0x8034;
  lwz r7, 0x30(r3);
  lbz r0, -0x6cc0(r6);
  lis r31, 0x8028;
  lwz r30, 0x1c(r7);
  mr r25, r3;
  cmplwi r0, 4;
  lwz r28, 0x18(r7);
  lhz r29, 0x14(r3);
  mr r26, r4;
  mr r27, r5;
  addi r31, r31, 0x5c30;
  blt lbl_8014bc80;
  lis r3, 8;
  mr r5, r26;
  addi r3, r3, 3;
  addi r4, r31, 0x6b0;
  bl LogMsg_1;
lbl_8014bc80:
  addi r0, r26, -3;
  cmplwi r0, 0x1b;
  bgt lbl_8014bdf0;
  lis r3, 0x8028;
  slwi r0, r0, 2;
  addi r3, r3, 0x6338;
  lwzx r3, r3, r0;
  mtctr r3;
  bctr;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014bcc8;
  lis r3, 8;
  lhz r5, 0x14(r25);
  addi r3, r3, 2;
  addi r4, r31, 0x40;
  bl LogMsg_1;
lbl_8014bcc8:
  mr r3, r25;
  bl l2cu_release_ccb;
  mr r12, r28;
  mr r3, r29;
  li r4, 0;
  mtctr r12;
  bctrl;
  b lbl_8014bdf0;
  mr r3, r25;
  bl l2cu_release_ccb;
  cmpwi r30, 0;
  beq lbl_8014bdf0;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014bd1c;
  lis r3, 8;
  mr r5, r29;
  addi r3, r3, 2;
  addi r4, r31, 0x6d8;
  bl LogMsg_1;
lbl_8014bd1c:
  mr r12, r30;
  mr r3, r29;
  li r4, 0;
  mtctr r12;
  bctrl;
  b lbl_8014bdf0;
  lwz r3, 0x10(r25);
  lbz r4, 0x36(r25);
  lhz r5, 0x14(r25);
  lhz r6, 0x16(r25);
  bl l2cu_send_peer_disc_rsp;
  mr r3, r25;
  bl l2cu_release_ccb;
  cmpwi r30, 0;
  beq lbl_8014bdf0;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014bd7c;
  lis r3, 8;
  mr r5, r29;
  addi r3, r3, 2;
  addi r4, r31, 0x6d8;
  bl LogMsg_1;
lbl_8014bd7c:
  mr r12, r30;
  mr r3, r29;
  li r4, 0;
  mtctr r12;
  bctrl;
  b lbl_8014bdf0;
  mr r3, r25;
  bl l2cu_release_ccb;
  cmpwi r30, 0;
  beq lbl_8014bdf0;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014bdc8;
  lis r3, 8;
  mr r5, r29;
  addi r3, r3, 2;
  addi r4, r31, 0x6d8;
  bl LogMsg_1;
lbl_8014bdc8:
  lis r3, 1;
  mr r12, r30;
  addi r0, r3, -4370;
  mr r3, r29;
  clrlwi r4, r0, 0x10;
  mtctr r12;
  bctrl;
  b lbl_8014bdf0;
  mr r3, r27;
  bl GKI_freebuf;
lbl_8014bdf0:
  addi r11, r1, 0x30;
  bl _restgpr_25;
  lwz r0, 0x34(r1);
  mtlr r0;
  addi r1, r1, 0x30;
  blr;
  // clang-format on
}

// Symbol: l2c_csm_w4_l2ca_disconnect_rsp
// PAL: 0x8014be08..0x8014bf64
MARK_BINARY_BLOB(l2c_csm_w4_l2ca_disconnect_rsp, 0x8014be08, 0x8014bf64);
asm UNKNOWN_FUNCTION(l2c_csm_w4_l2ca_disconnect_rsp) {
  // clang-format off
  nofralloc;
  stwu r1, -0x20(r1);
  mflr r0;
  stw r0, 0x24(r1);
  addi r11, r1, 0x20;
  bl _savegpr_27;
  lis r6, 0x8034;
  lwz r7, 0x30(r3);
  lbz r0, -0x6cc0(r6);
  mr r27, r3;
  lwz r31, 0x18(r7);
  mr r28, r4;
  cmplwi r0, 4;
  lhz r30, 0x14(r3);
  mr r29, r5;
  blt lbl_8014be5c;
  lis r3, 8;
  lis r4, 0x8028;
  mr r5, r28;
  addi r3, r3, 3;
  addi r4, r4, 0x63a8;
  bl LogMsg_1;
lbl_8014be5c:
  addi r0, r28, -3;
  cmplwi r0, 0x1b;
  bgt lbl_8014bf4c;
  lis r3, 0x8028;
  slwi r0, r0, 2;
  addi r3, r3, 0x63d0;
  lwzx r3, r3, r0;
  mtctr r3;
  bctr;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014bea8;
  lis r3, 8;
  lis r4, 0x8028;
  lhz r5, 0x14(r27);
  addi r3, r3, 2;
  addi r4, r4, 0x5c70;
  bl LogMsg_1;
lbl_8014bea8:
  mr r3, r27;
  bl l2cu_release_ccb;
  mr r12, r31;
  mr r3, r30;
  li r4, 0;
  mtctr r12;
  bctrl;
  b lbl_8014bf4c;
  lwz r3, 0x10(r27);
  lbz r4, 0x36(r27);
  lhz r5, 0x14(r27);
  lhz r6, 0x16(r27);
  bl l2cu_send_peer_disc_rsp;
  lis r3, 0x8034;
  lbz r0, -0x6cc0(r3);
  cmplwi r0, 3;
  blt lbl_8014bf04;
  lis r3, 8;
  lis r4, 0x8028;
  lhz r5, 0x14(r27);
  addi r3, r3, 2;
  addi r4, r4, 0x5c70;
  bl LogMsg_1;
lbl_8014bf04:
  mr r3, r27;
  bl l2cu_release_ccb;
  mr r12, r31;
  mr r3, r30;
  li r4, 0;
  mtctr r12;
  bctrl;
  b lbl_8014bf4c;
  lwz r3, 0x10(r27);
  lbz r4, 0x36(r27);
  lhz r5, 0x14(r27);
  lhz r6, 0x16(r27);
  bl l2cu_send_peer_disc_rsp;
  mr r3, r27;
  bl l2cu_release_ccb;
  b lbl_8014bf4c;
  mr r3, r29;
  bl GKI_freebuf;
lbl_8014bf4c:
  addi r11, r1, 0x20;
  bl _restgpr_27;
  lwz r0, 0x24(r1);
  mtlr r0;
  addi r1, r1, 0x20;
  blr;
  // clang-format on
}

// Symbol: forward_peer_data
// PAL: 0x8014bf64..0x8014c108
MARK_BINARY_BLOB(forward_peer_data, 0x8014bf64, 0x8014c108);
asm UNKNOWN_FUNCTION(forward_peer_data) {
  // clang-format off
  nofralloc;
  stwu r1, -0x20(r1);
  mflr r0;
  stw r0, 0x24(r1);
  addi r11, r1, 0x20;
  bl _savegpr_27;
  cmpwi r4, 0;
  mr r27, r3;
  mr r28, r4;
  beq lbl_8014bfac;
  lhz r0, 0x78(r3);
  cmpwi r0, 0;
  beq lbl_8014bfac;
  addi r3, r3, 0x70;
  bl GKI_enqueue;
  addi r3, r27, 0x70;
  bl GKI_dequeue;
  mr r28, r3;
  b lbl_8014bfc0;
lbl_8014bfac:
  cmpwi r4, 0;
  bne lbl_8014bfc0;
  addi r3, r3, 0x70;
  bl GKI_dequeue;
  mr r28, r3;
lbl_8014bfc0:
  lis r31, 0x8033;
  lis r30, 0x8028;
  addi r31, r31, 0x5d50;
  lis r29, 0x8034;
  b lbl_8014c0e8;
lbl_8014bfd4:
  lhz r5, 4(r28);
  cmplwi r5, 9;
  bge lbl_8014c010;
  lbz r0, -0x6cc0(r29);
  cmplwi r0, 1;
  blt lbl_8014bff8;
  addi r4, r30, 0x6440;
  lis r3, 8;
  bl LogMsg_1;
lbl_8014bff8:
  mr r3, r28;
  bl GKI_freebuf;
  addi r3, r27, 0x70;
  bl GKI_dequeue;
  mr r28, r3;
  b lbl_8014c0e8;
lbl_8014c010:
  addi r0, r5, -8;
  sth r0, 4(r28);
  clrlwi r0, r0, 0x10;
  add r5, r28, r0;
  lhz r4, 2(r28);
  addi r3, r5, 0xa;
  addi r0, r4, 4;
  sth r0, 2(r28);
  lwz r4, 0x10(r27);
  lhz r0, 0x28(r4);
  ori r0, r0, 0x2000;
  stb r0, 8(r5);
  lwz r4, 0x10(r27);
  lhz r0, 0x28(r4);
  ori r0, r0, 0x2000;
  srawi r0, r0, 8;
  stb r0, 9(r5);
  lhz r0, 0x7c(r31);
  lhz r4, 2(r28);
  cmplw r4, r0;
  ble lbl_8014c07c;
  stb r0, 0(r3);
  lhz r0, 0x7c(r31);
  srawi r0, r0, 8;
  stb r0, 1(r3);
  addi r3, r3, 2;
  b lbl_8014c090;
lbl_8014c07c:
  stb r4, 0(r3);
  lhz r0, 2(r28);
  srawi r0, r0, 8;
  stb r0, 1(r3);
  addi r3, r3, 2;
lbl_8014c090:
  lhz r6, 2(r28);
  mr r5, r28;
  li r4, 0;
  addi r0, r6, -4;
  stb r0, 0(r3);
  lhz r6, 2(r28);
  addi r0, r6, -4;
  srawi r0, r0, 8;
  stb r0, 1(r3);
  lhz r0, 0x16(r27);
  stb r0, 2(r3);
  lhz r0, 0x16(r27);
  srawi r0, r0, 8;
  stb r0, 3(r3);
  lhz r3, 2(r28);
  addi r0, r3, 4;
  sth r0, 2(r28);
  lwz r3, 0x10(r27);
  bl l2c_link_check_send_pkts;
  addi r3, r27, 0x70;
  bl GKI_dequeue;
  mr r28, r3;
lbl_8014c0e8:
  cmpwi r28, 0;
  bne lbl_8014bfd4;
  addi r11, r1, 0x20;
  bl _restgpr_27;
  lwz r0, 0x24(r1);
  mtlr r0;
  addi r1, r1, 0x20;
  blr;
  // clang-format on
}
