#include "gxInit.h"

#include <rvl/base/ppcArch.h>
#include <rvl/os/os.h>
#include <rvl/os/osReset.h>
#include <rvl/vi.h>

#include "gxAttr.h"
#include "gxBump.h"
#include "gxFifo.h"
#include "gxFrameBuf.h"
#include "gxGeometry.h"
#include "gxPixel.h"
#include "gxLight.h"
#include "gxMisc.h"
#include "gxTexture.h"
#include "gxTev.h"
#include "gxTransform.h"
#include "gxPerf.h"

extern const u32 unk_803886c8;
extern const u32 unk_803886cc;
extern const u32 unk_803886d0;
extern const u8 unk_803886d4;
extern const u8 unk_803886d5;
extern const u8 unk_803886d6;
extern const u8 unk_803886d7;
extern const u8 unk_803886d8;
extern const u8 unk_803886d9;
extern const u8 unk_803886da;
extern const u8 unk_803886db;
extern const u8 unk_803886dc;
extern const f32 unk_803886e0;
extern const f64 unk_803886e8;

// Symbol: __GXDefaultTexRegionCallback
// PAL: 0x8016b49c..0x8016b590
MARK_BINARY_BLOB(__GXDefaultTexRegionCallback, 0x8016b49c, 0x8016b590);
asm UNKNOWN_FUNCTION(__GXDefaultTexRegionCallback) {
  // clang-format off
  nofralloc;
  stwu r1, -0x20(r1);
  mflr r0;
  stw r0, 0x24(r1);
  stw r31, 0x1c(r1);
  stw r30, 0x18(r1);
  mr r30, r4;
  stw r29, 0x14(r1);
  mr r29, r3;
  bl GXGetTexObjFmt;
  mr r31, r3;
  mr r3, r29;
  bl GXGetTexObjMipMap;
  slwi r0, r30, 0x1d;
  srwi r4, r30, 0x1f;
  subf r0, r4, r0;
  cmpwi r31, 7;
  rotlwi r0, r0, 3;
  add r30, r0, r4;
  beq lbl_8016b548;
  bge lbl_8016b4f8;
  cmpwi r31, 6;
  bge lbl_8016b504;
  b lbl_8016b548;
lbl_8016b4f8:
  cmpwi r31, 0xb;
  bge lbl_8016b548;
  b lbl_8016b534;
lbl_8016b504:
  clrlwi. r0, r3, 0x18;
  beq lbl_8016b520;
  lwz r3, gx;
  slwi r0, r30, 4;
  add r3, r3, r0;
  addi r3, r3, 0x358;
  b lbl_8016b574;
lbl_8016b520:
  lwz r3, gx;
  slwi r0, r30, 4;
  add r3, r3, r0;
  addi r3, r3, 0x2d8;
  b lbl_8016b574;
lbl_8016b534:
  lwz r3, gx;
  slwi r0, r30, 4;
  add r3, r3, r0;
  addi r3, r3, 0x258;
  b lbl_8016b574;
lbl_8016b548:
  clrlwi. r0, r3, 0x18;
  beq lbl_8016b564;
  lwz r3, gx;
  slwi r0, r30, 4;
  add r3, r3, r0;
  addi r3, r3, 0x2d8;
  b lbl_8016b574;
lbl_8016b564:
  lwz r3, gx;
  slwi r0, r30, 4;
  add r3, r3, r0;
  addi r3, r3, 0x258;
lbl_8016b574:
  lwz r0, 0x24(r1);
  lwz r31, 0x1c(r1);
  lwz r30, 0x18(r1);
  lwz r29, 0x14(r1);
  mtlr r0;
  addi r1, r1, 0x20;
  blr;
  // clang-format on
}

// Symbol: __GXDefaultTlutRegionCallback
// PAL: 0x8016b590..0x8016b5b4
MARK_BINARY_BLOB(__GXDefaultTlutRegionCallback, 0x8016b590, 0x8016b5b4);
asm UNKNOWN_FUNCTION(__GXDefaultTlutRegionCallback) {
  // clang-format off
  nofralloc;
  cmplwi r3, 0x14;
  blt lbl_8016b5a0;
  li r3, 0;
  blr;
lbl_8016b5a0:
  lwz r4, gx;
  slwi r0, r3, 4;
  add r3, r4, r0;
  addi r3, r3, 0x3d8;
  blr;
  // clang-format on
}

// Symbol: __GXShutdown
// PAL: 0x8016b5b4..0x8016b720
MARK_BINARY_BLOB(__GXShutdown, 0x8016b5b4, 0x8016b720);
asm UNKNOWN_FUNCTION(__GXShutdown) {
  // clang-format off
  nofralloc;
  stwu r1, -0x10(r1);
  mflr r0;
  cmpwi r3, 0;
  stw r0, 0x14(r1);
  stw r31, 0xc(r1);
  bne lbl_8016b6a0;
  lwz r0, -0x6458(r13);
  cmpwi r0, 0;
  bne lbl_8016b61c;
  lwz r5, -0x646c(r13);
  lhz r4, 0x4e(r5);
lbl_8016b5e0:
  mr r0, r4;
  lhz r3, 0x50(r5);
  lhz r4, 0x4e(r5);
  cmplw r4, r0;
  bne lbl_8016b5e0;
  slwi r0, r4, 0x10;
  or r0, r0, r3;
  stw r0, -0x6468(r13);
  bl OSGetTime;
  li r0, 1;
  stw r3, -0x6460(r13);
  li r3, 0;
  stw r4, -0x645c(r13);
  stw r0, -0x6458(r13);
  b lbl_8016b70c;
lbl_8016b61c:
  bl OSGetTime;
  lwz r5, -0x646c(r13);
  lhz r7, 0x4e(r5);
lbl_8016b628:
  mr r0, r7;
  lhz r10, 0x50(r5);
  lhz r7, 0x4e(r5);
  cmplw r7, r0;
  bne lbl_8016b628;
  lwz r5, -0x645c(r13);
  li r0, 0;
  lwz r6, -0x6460(r13);
  slwi r9, r7, 0x10;
  subfc r8, r5, r4;
  li r5, 0xa;
  subfe r7, r6, r3;
  xoris r6, r0, 0x8000;
  subfc r5, r5, r8;
  xoris r0, r7, 0x8000;
  subfe r6, r6, r0;
  or r5, r9, r10;
  subfe r6, r0, r0;
  neg. r6, r6;
  beq lbl_8016b680;
  li r3, 0;
  b lbl_8016b70c;
lbl_8016b680:
  lwz r0, -0x6468(r13);
  cmplw r5, r0;
  beq lbl_8016b708;
  stw r3, -0x6460(r13);
  li r3, 0;
  stw r5, -0x6468(r13);
  stw r4, -0x645c(r13);
  b lbl_8016b70c;
lbl_8016b6a0:
  li r3, 0;
  bl GXSetBreakPtCallback;
  li r3, 0;
  bl GXSetDrawSyncCallback;
  li r3, 0;
  bl GXSetDrawDoneCallback;
  li r31, 0;
  lis r3, 0xcc01;
  stw r31, -0x8000(r3);
  stw r31, -0x8000(r3);
  stw r31, -0x8000(r3);
  stw r31, -0x8000(r3);
  stw r31, -0x8000(r3);
  stw r31, -0x8000(r3);
  stw r31, -0x8000(r3);
  stw r31, -0x8000(r3);
  bl PPCSync;
  lwz r4, -0x6474(r13);
  li r5, 3;
  lwz r3, gx;
  li r0, 1;
  sth r31, 2(r4);
  lwz r4, -0x6474(r13);
  sth r5, 4(r4);
  stb r0, 0x5fa(r3);
  bl __GXAbort;
lbl_8016b708:
  li r3, 1;
lbl_8016b70c:
  lwz r0, 0x14(r1);
  lwz r31, 0xc(r1);
  mtlr r0;
  addi r1, r1, 0x10;
  blr;
  // clang-format on
}

// Symbol: __GXInitRevisionBits
// PAL: 0x8016b720..0x8016b850
MARK_BINARY_BLOB(__GXInitRevisionBits, 0x8016b720, 0x8016b850);
asm UNKNOWN_FUNCTION(__GXInitRevisionBits) {
  // clang-format off
  nofralloc;
  li r0, 2;
  lwz r6, gx;
  li r7, 0;
  li r5, 8;
  lis r4, 0xcc01;
  mtctr r0;
lbl_8016b738:
  lwz r0, 0x1c(r6);
  ori r3, r7, 0x80;
  addi r7, r7, 1;
  oris r0, r0, 0x4000;
  stw r0, 0x1c(r6);
  lwz r0, 0x3c(r6);
  oris r0, r0, 0x8000;
  stw r0, 0x3c(r6);
  stb r5, -0x8000(r4);
  stb r3, -0x8000(r4);
  ori r3, r7, 0x80;
  addi r7, r7, 1;
  lwz r0, 0x3c(r6);
  stw r0, -0x8000(r4);
  lwz r0, 0x20(r6);
  oris r0, r0, 0x4000;
  stw r0, 0x20(r6);
  lwz r0, 0x40(r6);
  oris r0, r0, 0x8000;
  stw r0, 0x40(r6);
  stb r5, -0x8000(r4);
  stb r3, -0x8000(r4);
  ori r3, r7, 0x80;
  addi r7, r7, 1;
  lwz r0, 0x40(r6);
  stw r0, -0x8000(r4);
  lwz r0, 0x24(r6);
  oris r0, r0, 0x4000;
  stw r0, 0x24(r6);
  lwz r0, 0x44(r6);
  oris r0, r0, 0x8000;
  stw r0, 0x44(r6);
  stb r5, -0x8000(r4);
  stb r3, -0x8000(r4);
  ori r3, r7, 0x80;
  addi r7, r7, 1;
  lwz r0, 0x44(r6);
  stw r0, -0x8000(r4);
  lwz r0, 0x28(r6);
  oris r0, r0, 0x4000;
  stw r0, 0x28(r6);
  lwz r0, 0x48(r6);
  oris r0, r0, 0x8000;
  stw r0, 0x48(r6);
  stb r5, -0x8000(r4);
  stb r3, -0x8000(r4);
  lwz r0, 0x48(r6);
  addi r6, r6, 0x10;
  stw r0, -0x8000(r4);
  bdnz lbl_8016b738;
  lis r7, 0xcc01;
  li r8, 0x10;
  stb r8, -0x8000(r7);
  li r4, 0;
  li r0, 0x1000;
  li r5, 0x1012;
  stw r0, -0x8000(r7);
  ori r3, r4, 0x3f;
  ori r6, r4, 1;
  li r0, 0x61;
  stw r3, -0x8000(r7);
  li r3, 0x58;
  ori r4, r4, 0xf;
  stb r8, -0x8000(r7);
  rlwimi r4, r3, 0x18, 0, 7;
  stw r5, -0x8000(r7);
  stw r6, -0x8000(r7);
  stb r0, -0x8000(r7);
  stw r4, -0x8000(r7);
  blr;
  // clang-format on
}

// Symbol: GXInit
// PAL: 0x8016b850..0x8016bd54
MARK_BINARY_BLOB(GXInit, 0x8016b850, 0x8016bd54);
asm GXFifoObj* GXInit(void* buf, u32 size) {
  // clang-format off
  nofralloc;
  stwu r1, -0x20(r1);
  mflr r0;
  stw r0, 0x24(r1);
  addi r11, r1, 0x20;
  bl _savegpr_26;
  mr r27, r3;
  lwz r3, -0x72d0(r13);
  mr r26, r4;
  bl OSRegisterVersion;
  lwz r31, gx;
  li r0, 0;
  li r29, 1;
  li r3, 1;
  stb r0, 0x5f8(r31);
  li r4, 0;
  stb r29, 0x5f9(r31);
  stb r29, 0x5fa(r31);
  stw r0, 0x5e4(r31);
  stw r0, 0x5e8(r31);
  bl GXSetMisc;
  lis r4, 0xcc00;
  addi r5, r4, 0x3000;
  stw r4, -0x6474(r13);
  addi r3, r4, 0x1000;
  addi r0, r4, 0x4000;
  stw r5, -0x6478(r13);
  stw r3, -0x6470(r13);
  stw r0, -0x646c(r13);
  bl __GXFifoInit;
  lis r28, 0x8034;
  mr r4, r27;
  mr r5, r26;
  addi r3, r28, 0x3740;
  bl GXInitFifoBase;
  addi r3, r28, 0x3740;
  bl GXSetCPUFifo;
  addi r3, r28, 0x3740;
  bl GXSetGPFifo;
  lwz r0, -0x6454(r13);
  cmpwi r0, 0;
  bne lbl_8016b904;
  lis r3, 0x8029;
  addi r3, r3, -24688;
  bl OSRegisterShutdownFunction;
  stw r29, -0x6454(r13);
lbl_8016b904:
  bl __GXPEInit;
  bl PPCMfhid2;
  lis r4, 0xc01;
  mr r28, r3;
  addi r3, r4, -32768;
  bl PPCMtwpar;
  oris r3, r28, 0x4000;
  bl PPCMthid2;
  lwz r3, gx;
  li r8, 0;
  li r0, 0xf;
  li r5, 0xff;
  stw r8, 0x254(r3);
  rlwimi r5, r0, 0x18, 0, 7;
  li r0, 0x22;
  li r4, 0;
  stw r5, 0x174(r3);
  rlwimi r4, r0, 0x18, 0, 7;
  li r0, 8;
  mr r9, r3;
  stw r4, 0x7c(r3);
  li r26, 0;
  li r10, 0xc0;
  li r6, 0xff;
  mtctr r0;
lbl_8016b968:
  stw r8, 0x180(r9);
  srwi r12, r26, 1;
  rlwinm r7, r26, 1, 0, 0x1d;
  addi r11, r10, 1;
  stw r8, 0x1c0(r9);
  add r27, r3, r7;
  addi r26, r26, 1;
  addi r5, r12, 0xf6;
  stw r8, 0x150(r27);
  addi r0, r12, 0x28;
  rlwinm r7, r26, 1, 0, 0x1d;
  srwi r12, r26, 1;
  stw r6, 0x5a4(r9);
  addi r26, r26, 1;
  lwz r4, 0x180(r9);
  rlwimi r4, r10, 0x18, 0, 7;
  stw r4, 0x180(r9);
  lwz r4, 0x1c0(r9);
  rlwimi r4, r11, 0x18, 0, 7;
  addi r11, r10, 3;
  addi r10, r10, 2;
  stw r4, 0x1c0(r9);
  lwz r4, 0x200(r27);
  rlwimi r4, r5, 0x18, 0, 7;
  addi r5, r12, 0xf6;
  stw r4, 0x200(r27);
  lwz r4, 0x150(r27);
  rlwimi r4, r0, 0x18, 0, 7;
  addi r0, r12, 0x28;
  stw r4, 0x150(r27);
  add r27, r3, r7;
  stw r8, 0x184(r9);
  stw r8, 0x1c4(r9);
  stw r8, 0x150(r27);
  stw r6, 0x5a8(r9);
  lwz r4, 0x184(r9);
  rlwimi r4, r10, 0x18, 0, 7;
  addi r10, r10, 2;
  stw r4, 0x184(r9);
  lwz r4, 0x1c4(r9);
  rlwimi r4, r11, 0x18, 0, 7;
  stw r4, 0x1c4(r9);
  addi r9, r9, 8;
  lwz r4, 0x200(r27);
  rlwimi r4, r5, 0x18, 0, 7;
  stw r4, 0x200(r27);
  lwz r4, 0x150(r27);
  rlwimi r4, r0, 0x18, 0, 7;
  stw r4, 0x150(r27);
  bdnz lbl_8016b968;
  li r0, 0x27;
  li r4, 0;
  rlwimi r4, r0, 0x18, 0, 7;
  li r5, 0x30;
  li r0, 2;
  stw r4, 0x170(r31);
  mtctr r0;
lbl_8016ba4c:
  li r4, 0;
  addi r6, r5, 1;
  rlwimi r4, r5, 0x18, 0, 7;
  li r0, 0;
  stw r4, 0x108(r3);
  rlwimi r0, r6, 0x18, 0, 7;
  addi r6, r5, 3;
  addi r5, r5, 2;
  stw r0, 0x128(r3);
  li r4, 0;
  rlwimi r4, r5, 0x18, 0, 7;
  li r0, 0;
  stw r4, 0x10c(r3);
  rlwimi r0, r6, 0x18, 0, 7;
  addi r6, r5, 3;
  addi r5, r5, 2;
  stw r0, 0x12c(r3);
  li r4, 0;
  rlwimi r4, r5, 0x18, 0, 7;
  li r0, 0;
  stw r4, 0x110(r3);
  rlwimi r0, r6, 0x18, 0, 7;
  addi r6, r5, 3;
  addi r5, r5, 2;
  stw r0, 0x130(r3);
  li r4, 0;
  rlwimi r4, r5, 0x18, 0, 7;
  li r0, 0;
  stw r4, 0x114(r3);
  rlwimi r0, r6, 0x18, 0, 7;
  addi r5, r5, 2;
  stw r0, 0x134(r3);
  addi r3, r3, 0x10;
  bdnz lbl_8016ba4c;
  lwz r30, gx;
  lis r3, 0x1062;
  li r4, 0x20;
  li r0, 0x21;
  lwz r5, 0x148(r30);
  rlwimi r5, r4, 0x18, 0, 7;
  li r8, 0x41;
  li r7, 0x42;
  stw r5, 0x148(r30);
  li r6, 0x40;
  li r5, 0x43;
  lfs f1, unk_803886cc;
  lwz r4, 0x14c(r30);
  rlwimi r4, r0, 0x18, 0, 7;
  lfs f0, unk_803886d0;
  li r0, 0;
  stw r4, 0x14c(r30);
  lis r4, 0x8000;
  addi r3, r3, 0x4dd3;
  lwz r9, 0x220(r30);
  rlwimi r9, r8, 0x18, 0, 7;
  stw r9, 0x220(r30);
  lwz r8, 0x224(r30);
  rlwimi r8, r7, 0x18, 0, 7;
  stw r8, 0x224(r30);
  lwz r7, 0x228(r30);
  rlwimi r7, r6, 0x18, 0, 7;
  stw r7, 0x228(r30);
  lwz r6, 0x22c(r30);
  rlwimi r6, r5, 0x18, 0, 7;
  stw r6, 0x22c(r30);
  lwz r5, 0x24c(r30);
  rlwinm r5, r5, 0, 0x19, 0x16;
  stw r5, 0x24c(r30);
  stfs f1, 0x560(r30);
  stfs f0, 0x55c(r30);
  stw r0, 0x5fc(r30);
  stb r0, 0x5fb(r30);
  lwz r0, 0xf8(r4);
  mulhwu r0, r3, r0;
  srwi r26, r0, 5;
  bl __GXFlushTextureState;
  srwi r0, r26, 0xb;
  lis r29, 0xcc01;
  li r28, 0x61;
  oris r0, r0, 0x6900;
  stb r28, -0x8000(r29);
  ori r0, r0, 0x400;
  stw r0, -0x8000(r29);
  bl __GXFlushTextureState;
  lis r3, 0x3e10;
  stb r28, -0x8000(r29);
  addi r0, r3, -31775;
  mulhwu r0, r0, r26;
  srwi r0, r0, 0xa;
  oris r0, r0, 0x4600;
  ori r0, r0, 0x200;
  stw r0, -0x8000(r29);
  bl __GXInitRevisionBits;
  lis r28, 0x8029;
  addi r29, r30, 0x258;
  addi r27, r30, 0x2d8;
  addi r30, r30, 0x358;
  addi r28, r28, -24880;
  li r26, 0;
lbl_8016bbd8:
  lwz r5, 0(r28);
  mr r3, r29;
  lwz r7, 0x20(r28);
  li r4, 0;
  li r6, 0;
  li r8, 0;
  bl GXInitTexCacheRegion;
  lwz r5, 0x40(r28);
  mr r3, r27;
  lwz r7, 0x60(r28);
  li r4, 0;
  li r6, 0;
  li r8, 0;
  bl GXInitTexCacheRegion;
  lwz r5, 0x80(r28);
  mr r3, r30;
  lwz r7, 0xa0(r28);
  li r4, 1;
  li r6, 0;
  li r8, 0;
  bl GXInitTexCacheRegion;
  addi r26, r26, 1;
  addi r29, r29, 0x10;
  cmplwi r26, 8;
  addi r27, r27, 0x10;
  addi r30, r30, 0x10;
  addi r28, r28, 4;
  blt lbl_8016bbd8;
  addi r29, r31, 0x3d8;
  li r27, 0;
  lis r28, 0xc;
lbl_8016bc54:
  mr r3, r29;
  mr r4, r28;
  li r5, 0x10;
  bl GXInitTlutRegion;
  addi r27, r27, 1;
  addi r29, r29, 0x10;
  cmplwi r27, 0x10;
  addi r28, r28, 0x2000;
  blt lbl_8016bc54;
  addi r29, r31, 0x3d8;
  li r27, 0;
  lis r28, 0xe;
lbl_8016bc84:
  addi r0, r27, 0x10;
  mr r4, r28;
  slwi r0, r0, 4;
  li r5, 0x40;
  add r3, r29, r0;
  bl GXInitTlutRegion;
  addi r27, r27, 1;
  addis r28, r28, 1;
  cmplwi r27, 4;
  addi r28, r28, -32768;
  blt lbl_8016bc84;
  lwz r3, -0x6474(r13);
  li r12, 0;
  lis r9, 0xcc01;
  li r10, 8;
  sth r12, 6(r3);
  li r3, 0x20;
  li r8, 0x10;
  li r7, 0x1006;
  lwz r0, 0x5f4(r31);
  li r6, 0x61;
  lis r5, 0x2300;
  lis r4, 0x2400;
  rlwinm r11, r0, 0, 0x1c, 0x17;
  lis r0, 0x6700;
  stw r11, 0x5f4(r31);
  stb r10, -0x8000(r9);
  stb r3, -0x8000(r9);
  lwz r3, 0x5f4(r31);
  stw r3, -0x8000(r9);
  li r3, 0;
  stb r8, -0x8000(r9);
  stw r7, -0x8000(r9);
  stw r12, -0x8000(r9);
  stb r6, -0x8000(r9);
  stw r5, -0x8000(r9);
  stb r6, -0x8000(r9);
  stw r4, -0x8000(r9);
  stb r6, -0x8000(r9);
  stw r0, -0x8000(r9);
  bl __GXSetIndirectMask;
  li r3, 2;
  bl __GXSetTmemConfig;
  bl __GXInitGX;
  lis r3, 0x8034;
  addi r11, r1, 0x20;
  addi r3, r3, 0x3740;
  bl _restgpr_26;
  lwz r0, 0x24(r1);
  mtlr r0;
  addi r1, r1, 0x20;
  blr;
  // clang-format on
}

// Symbol: __GXInitGX
// PAL: 0x8016bd54..0x8016c668
MARK_BINARY_BLOB(__GXInitGX, 0x8016bd54, 0x8016c668);
asm UNKNOWN_FUNCTION(__GXInitGX) {
  // clang-format off
  nofralloc;
  stwu r1, -0xa0(r1);
  mflr r0;
  lis r10, 0x4330;
  stw r0, 0xa4(r1);
  stw r31, 0x9c(r1);
  li r31, 0;
  stw r30, 0x98(r1);
  lis r30, 0x8029;
  addi r30, r30, -25248;
  stw r29, 0x94(r1);
  stw r28, 0x90(r1);
  lbz r9, unk_803886d4;
  lbz r8, unk_803886d5;
  lbz r7, unk_803886d6;
  lbz r6, unk_803886d7;
  lbz r5, unk_803886d8;
  lbz r4, unk_803886d9;
  lbz r3, unk_803886da;
  lbz r0, unk_803886db;
  stw r10, 0x78(r1);
  stw r10, 0x80(r1);
  stb r9, 0x24(r1);
  stb r8, 0x25(r1);
  stb r7, 0x26(r1);
  stb r6, 0x27(r1);
  stb r5, 0x20(r1);
  stb r4, 0x21(r1);
  stb r3, 0x22(r1);
  stb r0, 0x23(r1);
  bl VIGetTvFormat;
  cmpwi r3, 2;
  beq lbl_8016be18;
  bge lbl_8016bde8;
  cmpwi r3, 0;
  beq lbl_8016bdf4;
  bge lbl_8016be00;
  b lbl_8016be24;
lbl_8016bde8:
  cmpwi r3, 5;
  beq lbl_8016be0c;
  b lbl_8016be24;
lbl_8016bdf4:
  lis r29, 0x8029;
  addi r29, r29, -23992;
  b lbl_8016be2c;
lbl_8016be00:
  lis r29, 0x8029;
  addi r29, r29, -23812;
  b lbl_8016be2c;
lbl_8016be0c:
  lis r29, 0x8029;
  addi r29, r29, -23752;
  b lbl_8016be2c;
lbl_8016be18:
  lis r29, 0x8029;
  addi r29, r29, -23872;
  b lbl_8016be2c;
lbl_8016be24:
  lis r29, 0x8029;
  addi r29, r29, -23992;
lbl_8016be2c:
  lwz r0, 0x24(r1);
  lis r4, 0x100;
  addi r3, r1, 0x1c;
  stw r0, 0x1c(r1);
  addi r4, r4, -1;
  bl GXSetCopyClear;
  li r3, 0;
  li r4, 1;
  li r5, 4;
  li r6, 0x3c;
  li r7, 0;
  li r8, 0x7d;
  bl GXSetTexCoordGen2;
  li r3, 1;
  li r4, 1;
  li r5, 5;
  li r6, 0x3c;
  li r7, 0;
  li r8, 0x7d;
  bl GXSetTexCoordGen2;
  li r3, 2;
  li r4, 1;
  li r5, 6;
  li r6, 0x3c;
  li r7, 0;
  li r8, 0x7d;
  bl GXSetTexCoordGen2;
  li r3, 3;
  li r4, 1;
  li r5, 7;
  li r6, 0x3c;
  li r7, 0;
  li r8, 0x7d;
  bl GXSetTexCoordGen2;
  li r3, 4;
  li r4, 1;
  li r5, 8;
  li r6, 0x3c;
  li r7, 0;
  li r8, 0x7d;
  bl GXSetTexCoordGen2;
  li r3, 5;
  li r4, 1;
  li r5, 9;
  li r6, 0x3c;
  li r7, 0;
  li r8, 0x7d;
  bl GXSetTexCoordGen2;
  li r3, 6;
  li r4, 1;
  li r5, 0xa;
  li r6, 0x3c;
  li r7, 0;
  li r8, 0x7d;
  bl GXSetTexCoordGen2;
  li r3, 7;
  li r4, 1;
  li r5, 0xb;
  li r6, 0x3c;
  li r7, 0;
  li r8, 0x7d;
  bl GXSetTexCoordGen2;
  li r3, 1;
  bl GXSetNumTexGens;
  bl GXClearVtxDesc;
  bl GXInvalidateVtxCache;
  li r28, 9;
lbl_8016bf38:
  lwz r4, gx;
  mr r3, r28;
  li r5, 0;
  bl GXSetArray;
  addi r28, r28, 1;
  cmplwi r28, 0x18;
  ble lbl_8016bf38;
  li r28, 0;
lbl_8016bf58:
  mr r3, r28;
  addi r4, r30, 0x80;
  bl GXSetVtxAttrFmtv;
  addi r28, r28, 1;
  cmplwi r28, 8;
  blt lbl_8016bf58;
  li r3, 6;
  li r4, 0;
  bl GXSetLineWidth;
  li r3, 6;
  li r4, 0;
  bl GXSetPointSize;
  li r3, 0;
  li r4, 0;
  li r5, 0;
  bl GXEnableTexOffsets;
  li r3, 1;
  li r4, 0;
  li r5, 0;
  bl GXEnableTexOffsets;
  li r3, 2;
  li r4, 0;
  li r5, 0;
  bl GXEnableTexOffsets;
  li r3, 3;
  li r4, 0;
  li r5, 0;
  bl GXEnableTexOffsets;
  li r3, 4;
  li r4, 0;
  li r5, 0;
  bl GXEnableTexOffsets;
  li r3, 5;
  li r4, 0;
  li r5, 0;
  bl GXEnableTexOffsets;
  li r3, 6;
  li r4, 0;
  li r5, 0;
  bl GXEnableTexOffsets;
  li r3, 7;
  li r4, 0;
  li r5, 0;
  bl GXEnableTexOffsets;
  lfs f0, unk_803886d0;
  addi r3, r1, 0x48;
  lfs f1, unk_803886dc;
  li r4, 0;
  stfs f0, 0x4c(r1);
  stfs f1, 0x48(r1);
  stfs f0, 0x50(r1);
  stfs f0, 0x54(r1);
  stfs f0, 0x58(r1);
  stfs f1, 0x5c(r1);
  stfs f0, 0x60(r1);
  stfs f0, 0x64(r1);
  stfs f0, 0x68(r1);
  stfs f0, 0x6c(r1);
  stfs f1, 0x70(r1);
  stfs f0, 0x74(r1);
  bl GXLoadPosMtxImm;
  addi r3, r1, 0x48;
  li r4, 0;
  bl GXLoadNrmMtxImm;
  li r3, 0;
  bl GXSetCurrentMtx;
  addi r3, r1, 0x48;
  li r4, 0x3c;
  li r5, 0;
  bl GXLoadTexMtxImm;
  addi r3, r1, 0x48;
  li r4, 0x7d;
  li r5, 0;
  bl GXLoadTexMtxImm;
  lhz r3, 4(r29);
  lhz r0, 8(r29);
  stw r3, 0x7c(r1);
  lfs f1, unk_803886d0;
  stw r0, 0x84(r1);
  lfd f4, unk_803886e8;
  fmr f2, f1;
  lfd f3, 0x78(r1);
  fmr f5, f1;
  lfd f0, 0x80(r1);
  fsubs f3, f3, f4;
  lfs f6, unk_803886dc;
  fsubs f4, f0, f4;
  bl GXSetViewport;
  addi r3, r30, 0x150;
  bl GXSetProjectionv;
  bl __GXSetGenMode;
  li r3, 0;
  bl GXSetCoPlanar;
  li r3, 2;
  bl GXSetCullMode;
  li r3, 0;
  bl GXSetClipMode;
  lhz r5, 4(r29);
  li r3, 0;
  lhz r6, 6(r29);
  li r4, 0;
  bl GXSetScissor;
  li r3, 0;
  li r4, 0;
  bl GXSetScissorBoxOffset;
  li r3, 0;
  bl GXSetNumChans;
  li r3, 4;
  li r4, 0;
  li r5, 0;
  li r6, 1;
  li r7, 0;
  li r8, 0;
  li r9, 2;
  bl GXSetChanCtrl;
  stw r31, 0x18(r1);
  addi r4, r1, 0x18;
  li r3, 4;
  bl GXSetChanAmbColor;
  lwz r0, 0x20(r1);
  addi r4, r1, 0x14;
  li r3, 4;
  stw r0, 0x14(r1);
  bl GXSetChanMatColor;
  li r3, 5;
  li r4, 0;
  li r5, 0;
  li r6, 1;
  li r7, 0;
  li r8, 0;
  li r9, 2;
  bl GXSetChanCtrl;
  stw r31, 0x10(r1);
  addi r4, r1, 0x10;
  li r3, 5;
  bl GXSetChanAmbColor;
  lwz r0, 0x20(r1);
  addi r4, r1, 0xc;
  li r3, 5;
  stw r0, 0xc(r1);
  bl GXSetChanMatColor;
  bl GXInvalidateTexAll;
  lis r3, 0x8017;
  addi r3, r3, -19300;
  bl GXSetTexRegionCallback;
  lis r3, 0x8017;
  addi r3, r3, -19056;
  bl GXSetTlutRegionCallback;
  addi r3, r1, 0x28;
  addi r4, r30, 0x60;
  li r5, 4;
  li r6, 4;
  li r7, 3;
  li r8, 0;
  li r9, 0;
  li r10, 0;
  bl GXInitTexObj;
  addi r3, r1, 0x28;
  li r4, 0;
  bl GXLoadTexObj;
  addi r3, r1, 0x28;
  li r4, 1;
  bl GXLoadTexObj;
  addi r3, r1, 0x28;
  li r4, 2;
  bl GXLoadTexObj;
  addi r3, r1, 0x28;
  li r4, 3;
  bl GXLoadTexObj;
  addi r3, r1, 0x28;
  li r4, 4;
  bl GXLoadTexObj;
  addi r3, r1, 0x28;
  li r4, 5;
  bl GXLoadTexObj;
  addi r3, r1, 0x28;
  li r4, 6;
  bl GXLoadTexObj;
  addi r3, r1, 0x28;
  li r4, 7;
  bl GXLoadTexObj;
  li r3, 0;
  li r4, 0;
  li r5, 0;
  li r6, 4;
  bl GXSetTevOrder;
  li r3, 1;
  li r4, 1;
  li r5, 1;
  li r6, 4;
  bl GXSetTevOrder;
  li r3, 2;
  li r4, 2;
  li r5, 2;
  li r6, 4;
  bl GXSetTevOrder;
  li r3, 3;
  li r4, 3;
  li r5, 3;
  li r6, 4;
  bl GXSetTevOrder;
  li r3, 4;
  li r4, 4;
  li r5, 4;
  li r6, 4;
  bl GXSetTevOrder;
  li r3, 5;
  li r4, 5;
  li r5, 5;
  li r6, 4;
  bl GXSetTevOrder;
  li r3, 6;
  li r4, 6;
  li r5, 6;
  li r6, 4;
  bl GXSetTevOrder;
  li r3, 7;
  li r4, 7;
  li r5, 7;
  li r6, 4;
  bl GXSetTevOrder;
  li r3, 8;
  li r4, 0xff;
  li r5, 0xff;
  li r6, 0xff;
  bl GXSetTevOrder;
  li r3, 9;
  li r4, 0xff;
  li r5, 0xff;
  li r6, 0xff;
  bl GXSetTevOrder;
  li r3, 0xa;
  li r4, 0xff;
  li r5, 0xff;
  li r6, 0xff;
  bl GXSetTevOrder;
  li r3, 0xb;
  li r4, 0xff;
  li r5, 0xff;
  li r6, 0xff;
  bl GXSetTevOrder;
  li r3, 0xc;
  li r4, 0xff;
  li r5, 0xff;
  li r6, 0xff;
  bl GXSetTevOrder;
  li r3, 0xd;
  li r4, 0xff;
  li r5, 0xff;
  li r6, 0xff;
  bl GXSetTevOrder;
  li r3, 0xe;
  li r4, 0xff;
  li r5, 0xff;
  li r6, 0xff;
  bl GXSetTevOrder;
  li r3, 0xf;
  li r4, 0xff;
  li r5, 0xff;
  li r6, 0xff;
  bl GXSetTevOrder;
  li r3, 1;
  bl GXSetNumTevStages;
  li r3, 0;
  li r4, 3;
  bl GXSetTevOp;
  li r3, 7;
  li r4, 0;
  li r5, 0;
  li r6, 7;
  li r7, 0;
  bl GXSetAlphaCompare;
  li r3, 0;
  li r4, 0x11;
  li r5, 0;
  bl GXSetZTexture;
  li r28, 0;
lbl_8016c3ac:
  mr r3, r28;
  li r4, 6;
  bl GXSetTevKColorSel;
  mr r3, r28;
  li r4, 0;
  bl GXSetTevKAlphaSel;
  mr r3, r28;
  li r4, 0;
  li r5, 0;
  bl GXSetTevSwapMode;
  addi r28, r28, 1;
  cmplwi r28, 0x10;
  blt lbl_8016c3ac;
  li r3, 0;
  li r4, 0;
  li r5, 1;
  li r6, 2;
  li r7, 3;
  bl GXSetTevSwapModeTable;
  li r3, 1;
  li r4, 0;
  li r5, 0;
  li r6, 0;
  li r7, 3;
  bl GXSetTevSwapModeTable;
  li r3, 2;
  li r4, 1;
  li r5, 1;
  li r6, 1;
  li r7, 3;
  bl GXSetTevSwapModeTable;
  li r3, 3;
  li r4, 2;
  li r5, 2;
  li r6, 2;
  li r7, 3;
  bl GXSetTevSwapModeTable;
  li r28, 0;
lbl_8016c444:
  mr r3, r28;
  bl GXSetTevDirect;
  addi r28, r28, 1;
  cmplwi r28, 0x10;
  blt lbl_8016c444;
  li r3, 0;
  bl GXSetNumIndStages;
  li r3, 0;
  li r4, 0;
  li r5, 0;
  bl GXSetIndTexCoordScale;
  li r3, 1;
  li r4, 0;
  li r5, 0;
  bl GXSetIndTexCoordScale;
  li r3, 2;
  li r4, 0;
  li r5, 0;
  bl GXSetIndTexCoordScale;
  li r3, 3;
  li r4, 0;
  li r5, 0;
  bl GXSetIndTexCoordScale;
  lfs f2, unk_803886dc;
  addi r4, r1, 8;
  stw r31, 8(r1);
  li r3, 0;
  fmr f4, f2;
  lfs f1, unk_803886d0;
  lfs f3, unk_803886e0;
  bl GXSetFog;
  li r3, 0;
  li r4, 0;
  li r5, 0;
  bl GXSetFogRangeAdj;
  li r3, 0;
  li r4, 4;
  li r5, 5;
  li r6, 0;
  bl GXSetBlendMode;
  li r3, 1;
  bl GXSetColorUpdate;
  li r3, 1;
  bl GXSetAlphaUpdate;
  li r3, 1;
  li r4, 3;
  li r5, 1;
  bl GXSetZMode;
  li r3, 1;
  bl GXSetZCompLoc;
  li r3, 1;
  bl GXSetDither;
  li r3, 0;
  li r4, 0;
  bl GXSetDstAlpha;
  li r3, 0;
  li r4, 0;
  bl GXSetPixelFmt;
  li r3, 1;
  li r4, 1;
  bl GXSetFieldMask;
  lhz r0, 8(r29);
  lhz r3, 0x10(r29);
  slwi r0, r0, 1;
  cmpw r3, r0;
  bne lbl_8016c554;
  li r4, 1;
  b lbl_8016c558;
lbl_8016c554:
  li r4, 0;
lbl_8016c558:
  lbz r3, 0x18(r29);
  bl GXSetFieldMode;
  lhz r5, 4(r29);
  li r3, 0;
  lhz r6, 6(r29);
  li r4, 0;
  bl GXSetDispCopySrc;
  lhz r3, 4(r29);
  lhz r4, 6(r29);
  bl GXSetDispCopyDst;
  lhz r3, 8(r29);
  lhz r0, 6(r29);
  stw r3, 0x7c(r1);
  lfd f2, unk_803886e8;
  stw r0, 0x84(r1);
  lfd f1, 0x78(r1);
  lfd f0, 0x80(r1);
  fsubs f1, f1, f2;
  fsubs f0, f0, f2;
  fdivs f1, f1, f0;
  bl GXSetDispCopyYScale;
  li r3, 3;
  bl GXSetCopyClamp;
  lbz r3, 0x19(r29);
  addi r4, r29, 0x1a;
  addi r6, r29, 0x32;
  li r5, 1;
  bl GXSetCopyFilter;
  li r3, 0;
  bl GXSetDispCopyGamma;
  li r3, 0;
  bl GXSetDispCopyFrame2Field;
  bl GXClearBoundingBox;
  li r3, 1;
  bl GXPokeColorUpdate;
  li r3, 1;
  bl GXPokeAlphaUpdate;
  li r3, 0;
  bl GXPokeDither;
  li r3, 0;
  li r4, 0;
  li r5, 1;
  li r6, 0xf;
  bl GXPokeBlendMode;
  li r3, 7;
  li r4, 0;
  bl GXPokeAlphaMode;
  li r3, 1;
  bl GXPokeAlphaRead;
  li r3, 0;
  li r4, 0;
  bl GXPokeDstAlpha;
  li r3, 1;
  li r4, 7;
  li r5, 1;
  bl GXPokeZMode;
  li r3, 0x23;
  li r4, 0x16;
  bl GXSetGPMetric;
  bl GXClearGPMetric;
  lwz r0, 0xa4(r1);
  lwz r31, 0x9c(r1);
  lwz r30, 0x98(r1);
  lwz r29, 0x94(r1);
  lwz r28, 0x90(r1);
  mtlr r0;
  addi r1, r1, 0xa0;
  blr;
  // clang-format on
}
